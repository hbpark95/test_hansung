using HANSUNG.Core.Common;
using HANSUNG.Core.Models;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace HANSUNG.Core.Service
{
    public class ContactService : BaseService
    {
        /// <summary>
        /// 연락처 리스트 가져오기
        /// </summary>
        /// <param name="vmodel"></param>
        public void GetContactList(ref ViewModelContactList vmodel, ref RouteGetContactList route)
        {
            try
            {
                #region
                //DateTime starttime = DateTime.Now;

                //List<Guid?> guidList = _config.Xrm.ContactSet.Select(x => x.ContactId).ToList();
                //int contactCount = guidList.Count;

                //DateTime endtime = DateTime.Now;

                //DateTime starttime1 = DateTime.Now;

                //int ccount = _config.Xrm.ContactSet.Count();

                //DateTime endtime1 = DateTime.Now;

                //List<string> lastnamelist = new List<string>() {"김",
                //                                                "이",
                //                                                "박",
                //                                                "최",
                //                                                "정",
                //                                                "강",
                //                                                "조",
                //                                                "윤",
                //                                                "장",
                //                                                "임",
                //                                                "한",
                //                                                "오",
                //                                                "서",
                //                                                "신",
                //                                                "권",
                //                                                "황",
                //                                                "안",
                //                                                "송",
                //                                                "전",
                //                                                "홍",
                //                                                "류",
                //                                                "고",
                //                                                "문",
                //                                                "양",
                //                                                "손",
                //                                                "배",
                //                                                "조",
                //                                                "백",
                //                                                "허",
                //                                                "유",
                //                                                "남",
                //                                                "심",
                //                                                "노",
                //                                                "정",
                //                                                "하",
                //                                                "곽",
                //                                                "성",
                //                                                "차",
                //                                                "주",
                //                                                "우",
                //                                                "구",
                //                                                "신",
                //                                                "임",
                //                                                "전",
                //                                                "민",
                //                                                "유",
                //                                                "류",
                //                                                "진",
                //                                                "나",
                //                                                "지",
                //                                                "엄",
                //                                                "채",
                //                                                "원",
                //                                                "천",
                //                                                "방",
                //                                                "공",
                //                                                "강",
                //                                                "현",
                //                                                "함",
                //                                                "변",
                //                                                "염",
                //                                                "양",
                //                                                "변",
                //                                                "여",
                //                                                "추",
                //                                                "노",
                //                                                "도",
                //                                                "소",
                //                                                "신",
                //                                                "석",
                //                                                "선",
                //                                                "설",
                //                                                "마",
                //                                                "길",
                //                                                "주",
                //                                                "연",
                //                                                "방",
                //                                                "위",
                //                                                "표",
                //                                                "명",
                //                                                "기",
                //                                                "반",
                //                                                "라",
                //                                                "왕",
                //                                                "금",
                //                                                "옥",
                //                                                "육",
                //                                                "인",
                //                                                "맹",
                //                                                "제",
                //                                                "모",
                //                                                "장",
                //                                                "남궁",
                //                                                "탁",
                //                                                "국",
                //                                                "여",
                //                                                "진",
                //                                                "어",
                //                                                "은",
                //                                                "편",
                //                                                "구",
                //                                                "용",
                //                                                "유",
                //                                                "예",
                //                                                "경",
                //                                                "봉",
                //                                                "정",
                //                                                "석",
                //                                                "사",
                //                                                "부",
                //                                                "황보",
                //                                                "가",
                //                                                "복",
                //                                                "태",
                //                                                "목",
                //                                                "진",
                //                                                "형",
                //                                                "계",
                //                                                "최",
                //                                                "피",
                //                                                "두",
                //                                                "지",
                //                                                "감",
                //                                                "장",
                //                                                "제갈",
                //                                                "음",
                //                                                "빈",
                //                                                "동",
                //                                                "온",
                //                                                "사",
                //                                                "호",
                //                                                "경",
                //                                                "범",
                //                                                "전",
                //                                                "선",
                //                                                "좌",
                //                                                "설",
                //                                                "팽",
                //                                                "승",
                //                                                "간",
                //                                                "하",
                //                                                "상",
                //                                                "시",
                //                                                "시",
                //                                                "갈",
                //                                                "서",
                //                                                "진",
                //                                                "단",
                //                                                "호",
                //                                                "소",
                //                                                "견",
                //                                                "당",
                //                                                "도",
                //                                                "화",
                //                                                "창",
                //                                                "방",
                //                                                "옹",
                //                                                "위",
                //                                                "승",
                //                                                "순",
                //                                                "강",
                //                                                "빙",
                //                                                "우",
                //                                                "종",
                //                                                "풍",
                //                                                "대",
                //                                                "엽",
                //                                                "지",
                //                                                "궁",
                //                                                "아",
                //                                                "평",
                //                                                "독",
                //                                                "원",
                //                                                "공",
                //                                                "양",
                //                                                "장",
                //                                                "백",
                //                                                "견",
                //                                                "장",
                //                                                "서",
                //                                                "모",
                //                                                "내",
                //                                                "이",
                //                                                "동",
                //                                                "판",
                //                                                "방",
                //                                                "류",
                //                                                "권",
                //                                                "마",
                //                                                "리",
                //                                                "황",
                //                                                "순",
                //                                                "엄",
                //                                                "양",
                //                                                "매",
                //                                                "초",
                //                                                "노",
                //                                                "창",
                //                                                "채",
                //                                                "심",
                //                                                "궉",
                //                                                "낭",
                //                                                "동",
                //                                                "로",
                //                                                "우",
                //                                                "묵",
                //                                                "곽",
                //                                                "근",
                //                                                "빈",
                //                                                "기",
                //                                                "양",
                //                                                "반",
                //                                                "점",
                //                                                "탄",
                //                                                "순",
                //                                                "해",
                //                                                "천",
                //                                                "정",
                //                                                "동",
                //                                                "사",
                //                                                "옹",
                //                                                "랑",
                //                                                "서",
                //                                                "국",
                //                                                "만",
                //                                                "류",
                //                                                "필",
                //                                                "한",
                //                                                "돈",
                //                                                "장",
                //                                                "하",
                //                                                "선",
                //                                                "운",
                //                                                "곡",
                //                                                "설",
                //                                                "구",
                //                                                "신",
                //                                                "어",
                //                                                "심",
                //                                                "조",
                //                                                "추",
                //                                                "야",
                //                                                "소",
                //                                                "섭",
                //                                                "자",
                //                                                "신",
                //                                                "순",
                //                                                "제",
                //                                                "사",
                //                                                "형",
                //                                                "연",
                //                                                "포",
                //                                                "홍",
                //                                                "기",
                //                                                "후",
                //                                                "원",
                //                                                "장",
                //                                                "필",
                //                                                "노",
                //                                                "최",
                //                                                "우",
                //                                                "황",
                //                                                "담",
                //                                                "림",
                //                                                "사",
                //                                                "로",
                //                                                "원",
                //                                                "진",
                //                                                "황",
                //                                                "국",
                //                                                "석",
                //                                                "정",
                //                                                "선",
                //                                                "하",
                //                                                "손",
                //                                                "홍",
                //                                                "국",
                //                                                "심",
                //                                                "민",
                //                                                "초",
                //                                                "도",
                //                                                "학",
                //                                                "강",
                //                                                "수",
                //                                                "고",
                //                                                "나",
                //                                                "조",
                //                                                "주",
                //                                                "봉",
                //                                                "요",
                //                                                "정",
                //                                                "유",
                //                                                "형",
                //                                                "안",
                //                                                "유",
                //                                                "장",
                //                                                "총",
                //                                                "사",
                //                                                "금",
                //                                                "부",
                //                                                "삼",
                //                                                "장",
                //                                                "애",
                //                                                "염",
                //                                                "최",
                //                                                "부",
                //                                                "이",
                //                                                "내",
                //                                                "안",
                //                                                "오",
                //                                                "정",
                //                                                "묘",
                //                                                "운",
                //                                                "원",
                //                                                "원",
                //                                                "단",
                //                                                "류",
                //                                                "부",
                //                                                "상",
                //                                                "연",
                //                                                "뇌",
                //                                                "려",
                //                                                "뢰",
                //                                                "오",
                //                                                "이",
                //                                                "경",
                //                                                "송",
                //                                                "지",
                //                                                "홍",
                //                                                "국",
                //                                                "나",
                //                                                "독",
                //                                                "모",
                //                                                "염",
                //                                                "주",
                //                                                "교",
                //                                                "미",
                //                                                "비",
                //                                                "서",
                //                                                "여",
                //                                                "왕",
                //                                                "이",
                //                                                "관",
                //                                                "궁",
                //                                                "노",
                //                                                "무",
                //                                                "방",
                //                                                "상",
                //                                                "소",
                //                                                "은",
                //                                                "조",
                //                                                "가",
                //                                                "대",
                //                                                "동",
                //                                                "영",
                //                                                "진",
                //                                                "진",
                //                                                "채",
                //                                                "나",
                //                                                "로",
                //                                                "변",
                //                                                "삼",
                //                                                "서",
                //                                                "성",
                //                                                "원",
                //                                                "은",
                //                                                "장",
                //                                                "진",
                //                                                "후",
                //                                                "곡",
                //                                                "방",
                //                                                "백",
                //                                                "범",
                //                                                "사공",
                //                                                "신",
                //                                                "양",
                //                                                "엄",
                //                                                "유",
                //                                                "제",
                //                                                "허",
                //                                                "권",
                //                                                "남",
                //                                                "등",
                //                                                "목",
                //                                                "방",
                //                                                "선",
                //                                                "신",
                //                                                "우",
                //                                                "윤",
                //                                                "제갈",
                //                                                "진",
                //                                                "교",
                //                                                "권",
                //                                                "기",
                //                                                "란",
                //                                                "배",
                //                                                "설",
                //                                                "영",
                //                                                "태",
                //                                                "홍",
                //                                                "강",
                //                                                "대",
                //                                                "등",
                //                                                "로",
                //                                                "산",
                //                                                "선우",
                //                                                "성",
                //                                                "송",
                //                                                "장",
                //                                                "전",
                //                                                "조",
                //                                                "조",
                //                                                "증",
                //                                                "증",
                //                                                "해",
                //                                                "홍",
                //                                                "홍",
                //                                                "금",
                //                                                "금",
                //                                                "난",
                //                                                "망절",
                //                                                "빈",
                //                                                "서",
                //                                                "성",
                //                                                "소",
                //                                                "손",
                //                                                "수",
                //                                                "어금",
                //                                                "위",
                //                                                "유",
                //                                                "한",
                //                                                "호",
                //                                                "황",
                //                                                "금",
                //                                                "다",
                //                                                "도",
                //                                                "라",
                //                                                "라",
                //                                                "문",
                //                                                "민",
                //                                                "석",
                //                                                "설",
                //                                                "양",
                //                                                "예",
                //                                                "위",
                //                                                "이",
                //                                                "장",
                //                                                "장",
                //                                                "주",
                //                                                "진",
                //                                                "현",
                //                                                "곽",
                //                                                "나",
                //                                                "노",
                //                                                "도",
                //                                                "도",
                //                                                "민",
                //                                                "박",
                //                                                "배",
                //                                                "배",
                //                                                "배",
                //                                                "백",
                //                                                "번",
                //                                                "보",
                //                                                "빈",
                //                                                "빈",
                //                                                "선",
                //                                                "설",
                //                                                "성",
                //                                                "소",
                //                                                "손",
                //                                                "순",
                //                                                "양",
                //                                                "엄",
                //                                                "예",
                //                                                "예",
                //                                                "오",
                //                                                "오",
                //                                                "완",
                //                                                "우",
                //                                                "우",
                //                                                "유",
                //                                                "윤",
                //                                                "종",
                //                                                "차",
                //                                                "천",
                //                                                "표",
                //                                                "호",
                //                                                "황",
                //                                                "후",
                //                                                "간",
                //                                                "강",
                //                                                "경",
                //                                                "계",
                //                                                "관",
                //                                                "구",
                //                                                "남궁",
                //                                                "도",
                //                                                "동",
                //                                                "등정",
                //                                                "민",
                //                                                "민",
                //                                                "보",
                //                                                "보",
                //                                                "상",
                //                                                "소",
                //                                                "소",
                //                                                "소",
                //                                                "수",
                //                                                "순",
                //                                                "시",
                //                                                "양",
                //                                                "연",
                //                                                "우",
                //                                                "은",
                //                                                "이",
                //                                                "임",
                //                                                "장",
                //                                                "장",
                //                                                "정",
                //                                                "제갈",
                //                                                "좌",
                //                                                "탕",
                //                                                "하",
                //                                                "한",
                //                                                "호",
                //                                                "황",
                //                                                "황"
                //                                                };
                //foreach(var last in lastnamelist)
                //{
                //    foreach (var contact in _config.Xrm.ContactSet.Where(x => x.FullName.StartsWith(last) && x.new_total_summary_contact == null))
                //    {
                //        Contact updateContact = new Contact()
                //        {
                //            ContactId = contact.ContactId,
                //            new_total_summary_contact = new EntityReference("new_total_summary", new Guid("B9B18AFC-7384-EA11-A811-000D3AA08B45"))
                //        };
                //        _config.OrgProxy.Update(updateContact);
                //    }
                //}

                #endregion

                List<Guid?> guidList = _config.Xrm.ContactSet.Select(x => x.ContactId).ToList();

                int count = guidList.Count();

                vmodel.data.contents.contactList.AddRange((from contact in _config.Xrm.ContactSet.OrderBy(x => x.FullName)
                                                           select new SubContact()
                                                           {
                                                               Email = contact.EMailAddress1,
                                                               FullName = contact.FullName
                                                           }).Skip((route.page - 1) * route.perPage).Take(route.perPage).ToList());

                vmodel.data.pagination.page = route.page;
                vmodel.data.pagination.totalCount = count;
                vmodel.result = true;
            }
            catch (Exception ex)
            {
                _exceptionLogger.Error(ex, "##### ContactService/GetContactList #####");
                if (ex.InnerException != null)
                {
                    _exceptionLogger.Error(ex.InnerException, "##### ContactService/GetContactList Innerexception #####");
                }
                vmodel.result = false;
            }
        }
    }
}
